<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Evaluador MSDA/TERC + ISM — v5</title>
<link rel="stylesheet" href="styles_v5.css">
</head>
<body>
<header>
  <h1>Evaluador MSDA/TERC + ISM — v5</h1>
  <p class="muted">Ingrese valores (0–100) para C1–C21 y para ISM (Equidad, Diversidad, Resonancia). Nombres completos y tablas de referencia incluidas.</p>
</header>

<main>
  <section class="card">
    <div class="row">
      <label class="lbl">Proyecto</label>
      <input id="projName" class="field" placeholder="Nombre del proyecto">
      <button id="goCalc" class="btn">Calcular + Dibujar</button>
      <button id="goPNG" class="btn ghost">Exportar PNG</button>
    </div>
  </section>

  <section class="card">
    <h2>Entradas — C1..C21 + ISM (0–100)</h2>
    <div class="grid">
      <div>
        <h3>Asimilación (Recepción de información)</h3>
        <label>C1 Carga Informativa del Espacio <input type="number" id="C1" min="0" max="100" class="num"></label>
        <label>C2 Diversidad Perceptual <input type="number" id="C2" min="0" max="100" class="num"></label>
        <label>C3 Conectividad y Riqueza Sensorial <input type="number" id="C3" min="0" max="100" class="num"></label>
        <label>C4 Accesibilidad y Focalización Cognitiva <input type="number" id="C4" min="0" max="100" class="num"></label>
        <h3>Acomodación (Transformación cognitiva)</h3>
        <label>C5 Plasticidad Ambiental <input type="number" id="C5" min="0" max="100" class="num"></label>
        <label>C6 Complejidad Estructural vs. Legibilidad <input type="number" id="C6" min="0" max="100" class="num"></label>
        <label>C7 Efecto de Resonancia Cognitiva <input type="number" id="C7" min="0" max="100" class="num"></label>
        <label>C8 Interacción Natural / Biofílica <input type="number" id="C8" min="0" max="100" class="num"></label>
      </div>
      <div>
        <h3>Equilibrio Adaptativo (Respuesta)</h3>
        <label>C9 Engagement Espacial <input type="number" id="C9" min="0" max="100" class="num"></label>
        <label>C10 Fluidez en la Navegación Espacial <input type="number" id="C10" min="0" max="100" class="num"></label>
        <label>C11 Memoria Espacial <input type="number" id="C11" min="0" max="100" class="num"></label>
        <label>C12 Resonancia Emocional <input type="number" id="C12" min="0" max="100" class="num"></label>
        <h3>Biomímesis (Bioestructural)</h3>
        <label>C13 Eficiencia Geométrica <input type="number" id="C13" min="0" max="100" class="num"></label>
        <label>C14 Optimización Estructural <input type="number" id="C14" min="0" max="100" class="num"></label>
        <label>C15 Uso de Biomateriales <input type="number" id="C15" min="0" max="100" class="num"></label>
      </div>
      <div>
        <h3>Biomímesis (Biofísica) y Ecosistémica</h3>
        <label>C16 Eficiencia Energética <input type="number" id="C16" min="0" max="100" class="num"></label>
        <label>C17 Adaptabilidad Térmica <input type="number" id="C17" min="0" max="100" class="num"></label>
        <label>C18 Captación y Uso de Agua <input type="number" id="C18" min="0" max="100" class="num"></label>
        <label>C19 Integración con la Naturaleza <input type="number" id="C19" min="0" max="100" class="num"></label>
        <label>C20 Ciclo de Materiales <input type="number" id="C20" min="0" max="100" class="num"></label>
        <label>C21 Bienestar Biofílico <input type="number" id="C21" min="0" max="100" class="num"></label>
        <h3>Índice Social Medible (ISM)</h3>
        <label>Equidad de acceso <input type="number" id="EQ" min="0" max="100" class="num"></label>
        <label>Diversidad de usos y actores <input type="number" id="DIV" min="0" max="100" class="num"></label>
        <label>Resonancia comunitaria <input type="number" id="RES" min="0" max="100" class="num"></label>
      </div>
    </div>
    <p class="small">Consejo: introduzca números de 0 a 100. Luego pulse <kbd>Calcular + Dibujar</kbd>.</p>
  </section>

  <section class="card">
    <h2>Radar MSDA/TERC (6) + Triángulo ISM (3)</h2>
    <canvas id="plot" width="980" height="980"></canvas>
  </section>

  <section class="card">
    <h2>Resumen y lectura</h2>
    <div id="badges" class="small"></div>
    <pre id="dump" class="mono"></pre>
  </section>

  <section class="card">
    <h2>Índices con nombres completos</h2>
    <ul class="small">
      <li><b>Índice de Percepción Cognitiva (IPC): C1–C4</b></li>
      <li><b>Índice de Adaptabilidad Espacial (IAE): C5–C8</b></li>
      <li><b>Índice de Inmersión y Memoria (IIM): C9–C12</b></li>
      <li><b>Índice de Eficiencia Bioestructural (IEB): C13–C15</b></li>
      <li><b>Índice de Adaptabilidad Biofísica (IAB): C16–C18</b></li>
      <li><b>Índice de Conectividad Ecosistémica (ICE): C19–C21</b></li>
    </ul>
  </section>

  <section class="card">
    <h2>Tablas de referencia rápida</h2>

    <h3>Definiciones por característica (C1…C21)</h3>
    <table>
      <thead><tr><th>Categoría</th><th>Código</th><th>Característica</th><th>Descripción</th></tr></thead>
      <tbody>
        <tr><td>Asimilación</td><td>C1</td><td>Carga Informativa del Espacio</td><td>Densidad informativa (patrones, texturas, materiales) que estimula la cognición.</td></tr>
        <tr><td>Asimilación</td><td>C2</td><td>Diversidad Perceptual</td><td>Activación multisensorial (visual, háptica, auditiva, olfativa).</td></tr>
        <tr><td>Asimilación</td><td>C3</td><td>Conectividad y Riqueza Sensorial</td><td>Organización espacial que favorece la experiencia.</td></tr>
        <tr><td>Asimilación</td><td>C4</td><td>Accesibilidad y Focalización Cognitiva</td><td>Legibilidad y guiado de la atención.</td></tr>

        <tr><td>Acomodación</td><td>C5</td><td>Plasticidad Ambiental</td><td>Adaptación del espacio a necesidades cambiantes.</td></tr>
        <tr><td>Acomodación</td><td>C6</td><td>Complejidad vs. Legibilidad</td><td>Equilibrio entre complejidad geométrica y lectura clara.</td></tr>
        <tr><td>Acomodación</td><td>C7</td><td>Efecto de Resonancia Cognitiva</td><td>Memoria y evocación.</td></tr>
        <tr><td>Acomodación</td><td>C8</td><td>Interacción Natural/Biofílica</td><td>Interacción con elementos naturales.</td></tr>

        <tr><td>Equilibrio Adaptativo</td><td>C9</td><td>Engagement Espacial</td><td>Participación activa e inmersión.</td></tr>
        <tr><td>Equilibrio Adaptativo</td><td>C10</td><td>Fluidez de Navegación</td><td>Orientación y wayfinding natural.</td></tr>
        <tr><td>Equilibrio Adaptativo</td><td>C11</td><td>Memoria Espacial</td><td>Anclajes cognitivos y familiaridad.</td></tr>
        <tr><td>Equilibrio Adaptativo</td><td>C12</td><td>Resonancia Emocional</td><td>Bienestar y conexión afectiva.</td></tr>

        <tr><td>Biomímesis (Bioestructural)</td><td>C13</td><td>Eficiencia Geométrica</td><td>Patrones naturales para optimizar cargas.</td></tr>
        <tr><td>Biomímesis (Bioestructural)</td><td>C14</td><td>Optimización Estructural</td><td>Principios biomecánicos aplicados.</td></tr>
        <tr><td>Biomímesis (Bioestructural)</td><td>C15</td><td>Uso de Biomateriales</td><td>Materiales sostenibles/circulares.</td></tr>

        <tr><td>Biomímesis (Biofísica)</td><td>C16</td><td>Eficiencia Energética</td><td>Estrategias bioclimáticas pasivas.</td></tr>
        <tr><td>Biomímesis (Biofísica)</td><td>C17</td><td>Adaptabilidad Térmica</td><td>Regulación inspirada en sistemas vivos.</td></tr>
        <tr><td>Biomímesis (Biofísica)</td><td>C18</td><td>Captación y Uso de Agua</td><td>Recolección/filtrado/uso eficiente.</td></tr>

        <tr><td>Ecosistémica</td><td>C19</td><td>Integración con la Naturaleza</td><td>Conexión armónica con el ecosistema.</td></tr>
        <tr><td>Ecosistémica</td><td>C20</td><td>Ciclo de Materiales</td><td>Economía circular: reutilización/reciclaje.</td></tr>
        <tr><td>Ecosistémica</td><td>C21</td><td>Bienestar Biofílico</td><td>Luz natural, vegetación, variaciones térmicas.</td></tr>
      </tbody>
    </table>

    <h3>Métrica del ISM (promedio de Equidad, Diversidad, Resonancia)</h3>
    <table>
      <thead><tr><th>Rango ISM (%)</th><th>Nivel</th><th>Caracterización cualitativa</th></tr></thead>
      <tbody>
        <tr><td>80–100</td><td>Muy Alto</td><td>Alta equidad, gran diversidad y fuerte resonancia comunitaria.</td></tr>
        <tr><td>70–79</td><td>Alto</td><td>Buen acceso y diversidad; limitaciones parciales.</td></tr>
        <tr><td>60–69</td><td>Medio</td><td>Funcional, no plenamente integrador.</td></tr>
        <tr><td>50–59</td><td>Bajo</td><td>Acceso restringido, baja diversidad, resonancia débil.</td></tr>
        <tr><td>&lt;50</td><td>Muy Bajo</td><td>Excluyente; sin diversidad ni memoria colectiva.</td></tr>
      </tbody>
    </table>

    <h3>Escala de Valoración Compuesta (EVC – TERC)</h3>
    <table>
      <thead><tr><th>Rango %</th><th>Nivel</th><th>Descripción</th></tr></thead>
      <tbody>
        <tr><td>80–100</td><td>Muy Alto</td><td>Espacios legibles, inmersivos, biofílicos y memorables; máxima cognición adaptativa.</td></tr>
        <tr><td>70–79</td><td>Alto</td><td>Proyectos equilibrados; buen desempeño general con limitaciones puntuales.</td></tr>
        <tr><td>60–69</td><td>Medio</td><td>Funcionales pero con desbalances; algún índice se desploma y arrastra el promedio.</td></tr>
        <tr><td>&lt;60</td><td>Bajo</td><td>Predominio de lo utilitario sobre lo simbiótico; resonancia cognitiva débil.</td></tr>
      </tbody>
    </table>
  </section>
</main>

<script>
const g = (id)=>document.getElementById(id);
const nv = (id)=>{ const x=parseFloat(g(id).value); return isNaN(x)?null:x; };
const prom = (a)=>{ const f=a.filter(v=>v!=null); return f.length? f.reduce((s,v)=>s+v,0)/f.length : null; };

function nivelBadge(p){
  if(p==null) return '<span class="badge">—</span>';
  if(p>=80) return '<span class="badge alto">Muy Alto</span>';
  if(p>=70) return '<span class="badge alto">Alto</span>';
  if(p>=60) return '<span class="badge medio">Medio</span>';
  if(p>=50) return '<span class="badge bajo">Bajo</span>';
  return '<span class="badge bajo">Muy Bajo</span>';
}
function relatoEVC(p){
  if(p==null) return '—';
  if(p>=80) return 'Muy Alto — Espacios legibles, inmersivos, biofílicos y memorables; máxima cognición adaptativa.';
  if(p>=70) return 'Alto — Proyecto equilibrado con buen desempeño general; limitaciones puntuales.';
  if(p>=60) return 'Medio — Funcional pero con desbalances; algún índice cae y arrastra el promedio.';
  return 'Bajo — Predominio de lo utilitario sobre lo simbiótico; resonancia cognitiva débil.';
}
function relatoISM(p){
  if(p==null) return '—';
  if(p>=80) return 'Muy Alto — Alta equidad de acceso, gran diversidad y fuerte resonancia comunitaria.';
  if(p>=70) return 'Alto — Buen acceso y diversidad; limitaciones parciales.';
  if(p>=60) return 'Medio — Socialmente funcional pero no integrador.';
  if(p>=50) return 'Bajo — Acceso restringido y baja diversidad; resonancia débil.';
  return 'Muy Bajo — Excluyente; mínima equidad y memoria colectiva.';
}

function calcAll(){
  const C1=nv('C1'), C2=nv('C2'), C3=nv('C3'), C4=nv('C4');
  const C5=nv('C5'), C6=nv('C6'), C7=nv('C7'), C8=nv('C8');
  const C9=nv('C9'), C10=nv('C10'), C11=nv('C11'), C12=nv('C12');
  const C13=nv('C13'), C14=nv('C14'), C15=nv('C15');
  const C16=nv('C16'), C17=nv('C17'), C18=nv('C18');
  const C19=nv('C19'), C20=nv('C20'), C21=nv('C21');

  const IPC = prom([C1,C2,C3,C4]);
  const IAE = prom([C5,C6,C7,C8]);
  const IIM = prom([C9,C10,C11,C12]);
  const IEB = prom([C13,C14,C15]);
  const IAB = prom([C16,C17,C18]);
  const ICE = prom([C19,C20,C21]);

  const EQ=nv('EQ'), DIV=nv('DIV'), RES=nv('RES');
  const ISM = prom([EQ,DIV,RES]);
  const MSDA = prom([IPC,IAE,IIM,IEB,IAB,ICE]);

  return {IPC,IAE,IIM,IEB,IAB,ICE,EQ,DIV,RES,ISM,MSDA};
}

function draw(){
  const cv = g('plot'); const ctx=cv.getContext('2d');
  const W=cv.width, H=cv.height; ctx.clearRect(0,0,W,H);
  const cx=W/2, cy=H/2, R=Math.min(W,H)*0.38;
  const ring = t=> R*(t/100);

  // anillos
  ctx.strokeStyle="#e1e1e1"; ctx.lineWidth=1;
  for(let t=0;t<=100;t+=10){ ctx.beginPath(); ctx.arc(cx,cy,ring(t),0,2*Math.PI); ctx.stroke(); }

  // ejes MSDA
  const axes = ["IPC","IAE","IIM","IEB","IAB","ICE"];
  const labels = [
    "Índice de\\nPercepción\\nCognitiva (IPC)",
    "Índice de\\nAdaptabilidad\\nEspacial (IAE)",
    "Índice de\\nInmersión y\\nMemoria (IIM)",
    "Índice de\\nEficiencia\\nBioestructural (IEB)",
    "Índice de\\nAdaptabilidad\\nBiofísica (IAB)",
    "Índice de\\nConectividad\\nEcosistémica (ICE)"
  ];
  const ang = axes.map((_,i)=> -Math.PI/2 + i*(2*Math.PI/axes.length));

  ctx.setLineDash([5,5]);
  labels.forEach((lab,i)=>{
    const a=ang[i], x=cx+R*Math.cos(a), y=cy+R*Math.sin(a);
    ctx.strokeStyle="#888"; ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(x,y); ctx.stroke();
    const lx=cx+(R+30)*Math.cos(a), ly=cy+(R+30)*Math.sin(a);
    ctx.fillStyle="#333"; ctx.font="12px system-ui,sans-serif"; ctx.textAlign="center"; ctx.textBaseline="middle";
    lab.split("\\n").forEach((s,k)=> ctx.fillText(s, lx, ly + (k-1)*14) );
  });
  ctx.setLineDash([]);

  const p = calcAll();

  // polígono MSDA
  const poly = axes.map((k,i)=>{
    const v = Math.max(0, Math.min(100, p[k] || 0));
    return [ cx + ring(v)*Math.cos(ang[i]), cy + ring(v)*Math.sin(ang[i]) ];
  });
  ctx.beginPath(); poly.forEach((pt,i)=> i?ctx.lineTo(pt[0],pt[1]) : ctx.moveTo(pt[0],pt[1])); ctx.closePath();
  ctx.fillStyle="rgba(0,0,0,.06)"; ctx.strokeStyle="#111"; ctx.lineWidth=2; ctx.fill(); ctx.stroke();

  // vértices + valor
  ctx.fillStyle="#111"; ctx.font="11px system-ui,sans-serif"; ctx.textAlign="center";
  poly.forEach((pt,i)=>{ ctx.beginPath(); ctx.arc(pt[0],pt[1],3,0,2*Math.PI); ctx.fill(); ctx.fillText(String(Math.round(p[axes[i]]||0)), pt[0], pt[1]-12); });

  // triángulo ISM (90°, 210°, 330°)
  const a3 = [-Math.PI/2, -Math.PI/2 + 2*Math.PI/3, -Math.PI/2 + 4*Math.PI/3];
  const vals = [p.EQ||0, p.DIV||0, p.RES||0].map(v=>Math.max(0,Math.min(100,v)));
  const tri = a3.map((a,i)=> [ cx + ring(vals[i])*Math.cos(a), cy + ring(vals[i])*Math.sin(a) ]);
  ctx.beginPath(); tri.forEach((pt,i)=> i?ctx.lineTo(pt[0],pt[1]) : ctx.moveTo(pt[0],pt[1])); ctx.closePath();
  ctx.fillStyle="rgba(200,0,0,.12)"; ctx.strokeStyle="rgba(200,0,0,.9)"; ctx.lineWidth=2; ctx.fill(); ctx.stroke();

  // etiquetas ISM
  const labs3=["Equidad de acceso","Diversidad de usos y actores","Resonancia comunitaria"];
  ctx.fillStyle="#b00000"; ctx.font="12px system-ui,sans-serif";
  tri.forEach((pt,i)=>{ ctx.beginPath(); ctx.arc(pt[0],pt[1],3,0,2*Math.PI); ctx.fill(); ctx.fillText(`${labs3[i]} (${Math.round(vals[i])})`, pt[0], pt[1]-12); });

  // título
  ctx.fillStyle="#111"; ctx.font="16px system-ui,sans-serif"; ctx.textAlign="center";
  ctx.fillText(`MSDA/TERC + ISM — ${g('projName').value || 'Proyecto sin nombre'}`, cx, 28);

  // lectura
  const MSDA = p.MSDA, ISM = p.ISM;
  document.getElementById('badges').innerHTML = `MSDA: ${nivelBadge(MSDA)} &nbsp; ISM: ${nivelBadge(ISM)}`;

  const texto = [
    `Índices (promedios):`,
    `  IPC=${p.IPC?.toFixed(2)} | IAE=${p.IAE?.toFixed(2)} | IIM=${p.IIM?.toFixed(2)} | IEB=${p.IEB?.toFixed(2)} | IAB=${p.IAB?.toFixed(2)} | ICE=${p.ICE?.toFixed(2)}`,
    `MSDA (promedio de 6 índices) = ${MSDA?.toFixed(2)} → ${relatoEVC(MSDA)}`,
    ``,
    `ISM (Equidad=${p.EQ?.toFixed(2)}, Diversidad=${p.DIV?.toFixed(2)}, Resonancia=${p.RES?.toFixed(2)})`,
    `ISM (promedio social) = ${ISM?.toFixed(2)} → ${relatoISM(ISM)}`
  ].join('\n');
  document.getElementById('dump').textContent = texto;
}

document.getElementById('goCalc').addEventListener('click', draw);
document.getElementById('goPNG').addEventListener('click', ()=>{
  const link = document.createElement('a');
  link.download = (document.getElementById('projName').value || 'radar_msda_ism') + '.png';
  link.href = document.getElementById('plot').toDataURL('image/png');
  link.click();
});
draw();
</script>
</body>
</html>
